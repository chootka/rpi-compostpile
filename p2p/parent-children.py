#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Script for Raspberry Pi for sending image data to one half of an arduino radio pair
# and receiving image data back from the other half of that pair.
#

from __future__ import print_function
import time
import io
from io import BytesIO
from RF24 import *
import RPi.GPIO as GPIO
from PIL import Image
from array import array
import requests

########### RADIO CONFIGURATION ###########
# Setup for GPIO 15 CE and CE0 CSN for RPi B+ with SPI Speed @ 8Mhz
radio = RF24(RPI_BPLUS_GPIO_J8_15, RPI_BPLUS_GPIO_J8_24, BCM2835_SPI_SPEED_8MHZ)

# Count up so we send a packet to all children
txNum = 0
# Count total number of transmission per packet per group of children
transmission_id = 1
# Increment text_id so we can step through our array of image data
text_id = 0
# Our image data
texts = [
"                                                                                                         :::::::::::::::::::,,,,,,,,,,,,,,,,,,,,,,,,,..........                                         "
"                                                                                                        .:::::::::::::::::::,,,,,,,,,,,,,,,,,,,,,,.,..........`                                         ",
"                                                                                                        ,::::::::::::::::::,,,,,,,,,,,,,,,,,,,.,,,...........`                                          ",
"                                                                                                        ,::::::::::::::::::,,,,,,,,,,,,,,,,,,,,.,............`                                          ",
"                                                                                                        ::::::::::::::::,,,,,,,,,,,,,,,,,,,,,,,,,...........`                                           ",
"                                                                                                       `::::::::::::::::,,,,,,,,,,,,,,,,,,,,,.,,............                                            ",
"                                                                                                       ,::::,:::::::::::,,,,,,,,,,,,,,,,,,,,,,.............`                                            ",
"                                                                                                       ,::,,:,,::,::::::,,,,,,,,,,,,,,,,,.,,,,.............                                             ",
"                                                                                                       ,::::,,,::::::::,,,,,,,,,,,,,,,,,,.,,..............`                                             ",
"                                                                                                       :::::::::,:::::,,,,,,,,,,,,,,,,,.,................`                                              ",
"                                                                                                      `::::,:::::::::,,,,,,,,,,,,,,,,.,.,................`                                              ",
"                                                                                                      ,,,::::::::::::,,,,,,,,,,,,,,,,,..................`                                               ",
"                                                                                                      .::,:::::::::::,,,,,,,,,,,,,,,,,..,..............`                                                ",
"                                                                                                      ,:::,::::::::::,,,,,,,,,,,,,,,..,.,..............`                                                ",
"                                                                                                      ,:,:::::::::::,,,,,,,,,,,,,,,,,,,................                                                 ",
"                                                                                                      ,,::::::::::::,,,,,,,,,,,,,,,,,,................`                                                 ",
"                                                                                                     .:::::::::::::,,,,,,,,,,,,,,,,,,,................`                                                 ",
"                                                                                                     ,:::::::::::::,,,,,,,,,,,,,,,,,.................`                                                  ",
"                                                                                                     ,::::::::::::,,,,,,,,,,,,,,,,,,.................`                                                  ",
"                                                                                              `      ,::::::::::::,,,,,,,,,,,,,,,,,,.................                                                   ",
"                                                                                                     ,::::::::::::,,,,,,,,,,,,,,,,..................`                                                   ",
"                                                                                               `     ,::::::::::::,,,,,,,,,,,,,,,,.,...............`                                                    ",
"                                                                                                    `,::::::::::::,,,,,,,,,,,,,,...................`                                                    ",
"                                                                                                    `,::::::::::::,,,,,,,,,,,,.,,,................`                                                     ",
"                                                                                                    .::::::::::::::,,,,,,,,,,.,.,.................`                                                     ",
"                                                                                                    ,::::::::::::,,,,,,,,,,,,,.,.................`                                                      ",
"                                                                                                    ,::::::::::,,,,,,,,,,,,,,,,..................`                                                      ",
"                                                                                                    ,:::::::::::,,,,,,,,,,,,,...................`                                                       ",
"                                                                                                    ,::::::::::,,,,,,,,,,,,,,,,.................`                                                       ",
"                                                                                                    ,::::::::::,,,,,,,,,.,,,,,,.................`                                                       ",
"                                                                                                    ,:::::::::,,,,,,,,,,,,,.,..................`                                                        ",
"                                                                                                    ,:::::::::,,,,,,,,,,,,,...................``                                                        ",
"                                                                                                   `,:::::::::,,,,,,,,,,,,....................`                                                         ",
"                                                                                                   `,::::::::,,,,,,,,,,,,,....................`                                                         ",
"                                                                                                   .,:::::::::,,,,,,,,,,,.,..................`                                                          ",
"                                                                                                   .:::::::,,,,,,,,,,,,,,,,,................``                                                          ",
"                                                                                                   ,,:::::::,,,,,,,,,,,,,...................`                                                           ",
"                                                                                                   ,:::::::,,,,,,,,,,,,,....................`                                                           ",
"                                                                                                   ,,::::,,,,,,,,,,,,,,,,,.................`                                                            ",
"                                                                                                   ,,::,,,,,,,,,,,,,,,,,...................`                                                            ",
"                                                                                                  `,,::,,,,,,,,,,,,,,...................`.`                                                             ",
"                                                                                                  `,,,:,,,,,,,,,,,,,,,...................``                                                             ",
"                                                                                                  `,,,,,,,,,,,,,,,,,,....................``                                                             ",
"                                                                                                  .,,,,,,,,,,,,,,,,......................`                                                              ",
"                                                                                                  .,,,,,,,,,,,,,,,,.....................``                                                              ",
"                                                                                                  .,,,,,,,,,,,,,,,,.....................`                                                               ",
"                                                                                                  .,,,,,,,,,,,,,,,.....................``                                                               ",
"                                                                                                  ,,,,,,,,,,,,,,,,,....................``                                                               ",
"                                                                                                  .,,,,,,,,,,,,,,......................`                                                                ",
"                                                                                                  .,,,,,,,,,,,,,,,....................``                                                                ",
"                                                                                                  .,,,,,,,,,,,,,,,...................``                                                                 ",
"                                                                                                  ,,,,,,,,,,,,,,,,..................`.`                                                                 ",
"                                                                                                  ,,,,,,,,,,,,,,,....................``                                                                 ",
"                                                                                                  .,,,,,,,,,,,,,.................`...`                                                                  ",
"                                                                                                  .,,,,,,,,,,,,,....................``                                                                  ",
"                                                                                                  ,,,,,,,,,,,,,,..............`.....`                                                                   ",
"                                                                                                  ,,,,,,,,,,,,,,,...................`                                                                   ",
"                                                                                                  .,,,,,,,,,,,,,,.................```                                                                   ",
"                                                                                                  .,,,,,,,,,,,,,...................`                                                                    ",
"                                                                                                  .,,,,,,,,,,,,....................`                                                                    ",
"                                                                                                  .,,,,,,,,,,,,...................`                                                                     ",
"                                                                                                 `,,,,,,,,,,,,,..................``                                                                     ",
"                                                                                                 `.,,,,,,,,,,,...................``                                                                     ",
"                                                                                                  .,,,,,,,,,,,,..................`                                                                      ",
"                                                                                                  .,,,,,,,,,,...................``                                                                      ",
"                                                                                                  ..,,..,,,,,...................``                                                                      ",
"                                                                                                  .,,,,,.,,,,...................`                                                                       ",
"                                                                                                  `,,,,,,..,,..................``                                                                       ",
"                                                                                                  .,,,,,,,,.,..................``                                                                       ",
"                                                                                                  .,,,,,,,,,...................``                                                                       ",
"                                                                                                 `,,:,,,,,,.,..................`                                                                        ",
"                                                                                                 `.....,,,,...................``                                                                        ",
"                                                                                                 ..,,...,,,,..................``                                                                        ",
"                                                                                               ` .,,,...,,....,..............``                                                                         ",
"                                                                                       `       `..,,,...,,....,...............`                                                                         ",
"                                                                                                ,.,,,..,,..,.................``                                                                         ",
"                                                                                               .,:,,,,,,,,..................```                                                                         ",
"                                                                                               ,,::,,,,,,...................``                                                                          ",
"                                                                                              .,::,,,,,,.,,.................``                                                                          ",
"                                                                                              ,:,,::,,.,,,..................``                                                                          ",
"                                                                                             ..,::,,,.,,,,.................```                                                                          ",
"                                                                                             .,:::::,,,,,,,,.,............```                                                                           ",
"                                                                                            `,,::::::,,,,,,,,,,............``                                                                           ",
"                                                                                            .,:::::,:::,,,,,,,,,,,.........``                                                                           ",
"                                                                                            ,,:::::::,,,::,,,,,,,,:,,.....```                                                                           ",
"                                                                                           .,::::::::::,,:::,,,,,,,,,,,...```                                                                           ",
"                                                                                          `,:::::::::::::,,::::,,,,,.....````                                                                           ",
"                                                                                         `,::::::::::::::::,,,,,,,,......````                                                                           ",
"                                                                                        `,::::::::::::::::::,,,,,.......`.```                                                                           ",
"                                                                                       `,:::::;;;::::::,,,,,,,,,........````                                                                            ",
"                                                                                      .,:::::;;;::::::::,,,,,,,........`````                                                                            ",
"                                                                                     .,:::::;:::::::,,,,,,,...........``````                                                                            ",
"                                                                                    ,:::::::::::::,,,,,,,,,...........``````                                                                            ",
"                                                                                   ,::::::::::::,,,,,,,..............```````                                                                            ",
"                                                                                 `,::::::::::,,,,,,,,........`......````````                                                                            ",
"                                                                                .,:::::::::,,,,,,,,,,,.......`.`.```````````                                                                            ",
"                                                                               .:::::::::,,,,,,,,,,,,...........````````````                                                                            ",
"                                                                              ,::::::::::,,,,,,,.............````````......`                                                                            ",
"                                                                             ,:::::::::,,,,,,,,,.........`.````````........``                                                                           ",
"                                                                            ,::::::::::,,,,,,,.....`....``````````....``..```                                                                           ",
"                                                                           ,::::::::::,,,,,,.......````````````..``````...```                                                                           ",
"                                                                          ,:::::::::,,,,,.........``````````..`.`````...``.``                                                                           ",
"                                                                         ,::::::::,,,,,,.......`````````...``..``````..``..``                                                                           ",
"                                                                        ,::::::::::,,,,....`..````````..```..````````.```````                                                                           ",
"                                                                       ,::::::::::,,,,,....`.```.````...`..`````````````````                                                                            ",
"                                                                      ,::::::::::,,,,...`..``.``.`........``````````````.```                                                                            ",
"                                                                     ,::::,,::,,,,.......`.````..........`````````````.````                                                                             ",
"                                                                    ,,,,,,,,,,,,..,..``.``.``...........```````````````````                                                                             ",
"                                                                   `,,,,,,,,,,,,,..,.``````.............```.``````````````                                                                              ",
"                                                                  ..,,,,,,,,...........````................``````````````                                                                               ",
"                                                                 ,,..,,,,,,,.....`....,......................`.``````````                                                                               ",
"                                                                .,,..,,,,,,.......``............,............```````````                                                                                ",
"                                                                ,,,,,,,.,,,...,..........,.....,...........`..`````````                                                                                 ",
"                                                               `,,,,,,,,.,,.....,,......,.....,..............``````````                                                                                 ",
"                                                               .,,,,,,,,,,.,,,,,,.,,...,.....,,............```````````                                                                                  ",
"                                                               .,,,,.,,,,.,.,,..,......,....,,.............``````````                                                                                   ",
"                                                               .,,,,.,,,,,.....,,,.........,,..............`````````                                                                                    ",
"                                                               .,,...,,,,,,,,.....,:,......,................```````                                                                                     ",
"                                                              `,,,....,,,,,,,,,..,.,,,.....,..............````````                                                                                      ",
"                                                              .,,,....,,,,,,,,,,..,..,....,............`.`````````                                                                                      ",
"                                                              ,,,,,...,,,,,,.,,.,,,,,,.........``.........````..`                                                                                       ",
"                                                             `,,,,,,,,,,,,,,.......,,,....`   .,,,.......```.```                                                                                        ",
"                                                             .,,,,,,,,,,:,,,,......,,,..`     ,,,,,.......`.`.`                                                                                         ",
"                                                            `,,,,,,,,,:,,,,,.......,,,,.     `,,.......``.``.`                                                                                          ",
"                                                            .,,,,,,,,:,,.,,,........,,,,`    ........````````                                                                                           ",
"                                                           ..,,,,,,,,,,,,,,,,,.......,,,,.  .......`````````                                                                                            ",
"                                                          `,,,,,,,,,,,,,,,,,,,,,,.....,,,,,.......```.``.```                                                                                            ",
"                                                          .,,,,,,,,,,,,...,.,:,,,.......,,,,,....``````.```                                                                                             ",
"                                                         `,,,,,,,,,,,,,......,,,...........,,,,..`.`..`.``                                                                                              ",
"                                                         ,,.,,,,,,,,,,......``..............,,,,...```````                                                                                              ",
"                                                        .,,,,,,,,,,,,,.....`   `.............,,:,,`..`..`                                                                                               ",
"                                                       .,,,,,,,,,,,,,,.....      `..............,,,,..``                                                                                                ",
"                                                      ..,,,,,,,,,,,,,,,....         `.........,....,,..`                                                                                                ",
"                                                     ,,,,,,,,,,,,,,::,,...`           ``.`......,.,,.,..                                                                                                ",
"                                                    `,.,,,,,,,,,,,:::,,,,,              `.`..............`                                                                                              ",
"                                                    ,,,,,,,,,,,,,,,,,::::,              ...`...,`.........`                                                                                             ",
"                                                   .,,,,,,,.,,,..,,,,,:::,,             .`..`..`...........`                                                                                            ",
"                                                  `,,.,,,,,,.......,,,,,,,,,`           `.``..``......`.....                                                                                            ",
"                                                  ..,.,,,,,,,........,,,,,,,,.          `````.````.....``..``                                                                                           ",
"                                                 ....,,,,,,.,..........,,,,,,,,`        ````.````````````````                                                                                           ",
"                                                `.....,,,,,,,,,,.........,,,,,,.`         `````````   ``````                                                                                            ",
"                                                ........,,,,,,,,...........,,,,,.`      ``   ````       ```                                                                                             ",
"                                               `,..........,,,,,,,..........,,,,,.      `                                                                                                               ",
"                                               ............,,,,,,,, ..`......,,,,,,`                                                                                                                    ",
"                                              .,............,,,.,,.  ```......,,,,,,.`                                                                                                                  ",
"                                             `,,...........,,,,,...`   `.......,,,,,,,,`                                                                                                                ",
"                                             ,,,,...........,,,.....     `.......,,,,,,,,.                                                                                                              ",
"                                            .,,..............,......       .........,,,,,,.`                                                                                                            ",
"                                           `,.........``....,,......        `.........,,,,,.`                                                                                                           ",
"                                           .....``````  ....,,......`         `.........,,,..                                                                                                           ",
"                                          ....`.````    `...........`           `............`                                                                                                          ",
"                                         ...```````      ....,,.....`              ``.....``.`                                                                                                          ",
"                                        ...```````       `..,,,,,,..`               ````..````                                                                                                          ",
"                                        ````````          ..,,,,,,,.`                 ````````                                                                                                          ",
"                                          ```             `,,,,,.,,..                   ````                                                                                                            ",
"                                                           ,,,,,,,,..`                                                                                                                                  ",
"                                                           ...,,,,....                                                                                                                                  ",
"                                                           `.,,,,.....                                                                                                                                  ",
"                                                            .,,,......                                                                                                                                  ",
"                                                            `,,.,.....`                                                                                                                                 ",
"                                                             .,,......`                                                                                                                                 ",
"                                                             .........`                                                                                                                                 ",
"                                                             `.......``                                                                                                                                 ",
"                                                              ......``                                                                                                                                  ",
"                                                              ..`````                                                                                                                                   ",
"                                                              ``````                                                                                                                                    ",
"                                                                                                                                                                                                        ",
"                                                                                                                                                                                                        ",
"                                                                                                                                                                                                        ",
"                             `.+.                                 ",
"                                .++++++++'.                                ",
"                               '+++++++++'+'                               ",
"                              ''++++++++++'''                              ",
"                             ''+++++++++++++''                             ",
"                       ;    :''+++++++++++++'''                            ",
"                     :+++'; ''+++++++++'''''''';                           ",
"                   :''+++++''++++++++'''+++''''',                          ",
"                  '++++++++'''+++++'''+++++++++';`                         ",
"                ;'++++++++''+'+++''''++++++++'+'';'`                       ",
"              `'''+++++++'''''''''''''+++++++++''''''                      ",
"             :'+'''+++++''''+'+++++++'''++++++++''''''.                    ",
"             ;'+++++++++''''+++++++''+''''++++'++'+'''''                   ",
"             .'++++++++''''''++++'+++++++''+++''+'++'++''.                 ",
"             :''++++++'++''''+++'++++++++'+++++'+'++'+++'''`               ",
"             +++++++++''+''''++'''++++++++'''#+'+'+++++++''':              ",
"             ++++++++'+'+''''+''++++###+++''''#'+'++++++++''';             ",
"             +++++++++'++''''+'++'++''##++++''#+'''+++++++++''`            ",
"             +++++++++'++'''++''++++#+++#++++'#+''''++##+++++++            ",
"            `'+++++#++'++'''#'''+++###++##+++'##+'''#+##+++++++            ",
"             ''''+++++'++'''#+'++++####+@@##+'##+'+'#+###++++++            ",
"             ,''++++++''++''+++#+++#+##'##@#+'##+'+'+++##+++++'            ",
"               ;++++++''+#''+++#++####'++###++##+'+'+#+##+++++,            ",
"               `+++++#+'+#''##+##+++++++++#@'+@+'+'''####++++'             ",
"                +''++##''#+'+#+'##++++++++#'++@+'+'''####++++'             ",
"                `'+++###'+++'#+++'++++++++'''+++'+'''####+++':             ",
"                '''++###+'#''##+'+++++++''++++#++''''###++++'              ",
"               `'''++###@+'+''##+++++++'++++'#++'''''###++++               ",
"               ,''''+###@#+++;###++++'+++++++#++''''+###+++`               ",
"               `''''++##@##+++''##++++++++'+##++''''@###+++                ",
"                ''''++######+++++''''''''+###+#''''+###+++'                ",
"                ''+'++####+++++++++++++++#####+''''####+++                 ",
"                .'+''+##@##''++#+++++########+''''##@+++++                 ",
"                 '+''++@@@##'+''''+#########''''######+++`                 ",
"                 `'+''+#@@###+'''''''''+++''''+######++##                  ",
"                  `+''+#@@@###+''''''''''''+#+######++++.+                 ",
"                    '''#@@######++++++'+#####+#####+++##                   ",
"                    #''''''+###############++++++##++++#:                  ",
"                   ###+''''''''''+++++++++++++#####+++#..                  ",
"                  .####+''''''''''++++++++++######+++++#                   ",
"                  :####@#+++''++'++++++++++######+++++#                    ",
"                  ;##########+++++++++++#########+++++                     ",
"                   #############################++++++                     ",
"                  `############################++++++                      ",
"                    #####@@###################+++++#:                      ",
"                    ######.#+#################+#++,                        ",
"                     ####+@ :@###############+#+;                          ",
"                     :###; `   :########@###++'                            ",
"                       :#         #########++                              ",
"                                  :######++##                              ",
"                                   :'+++'                                  ",
"                                   ,+++'                                   ",
"                                   .'++'                                   ",
"                                   `'++'                                   ",
"                                    '++'                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                    '+++                                   ",
"                                                                                          '',                                                                                                            ",
"                                                                                            .:                '', ''`                                                                                          ",
"                                                                                           ;:             '', '',.''                                                                                          ",
"                                                                                          .;,:        .:.'', '';:;'+`.                                                                                        ",
"                                                                                           ';,,       '', '';++':;;'`;;;``                                                                                     ",
"                                                                                      :'  .;;,,. :''' ``+'+ :;`'', '':;;''                                                                                     ",
"                                                                                 `    +;; ,;::,.;'''` ``++,  :  '', ;'':`                                                                                      ",
"                                                                                ':   +'';.':,:''+';  ''``.'.':,':;;;:;,`                                                                                     ",
"                                                                                ';;  #;;+ '::;'';',```.,,;#   '+ ''';;;;;                                                                                  ",
"                                                                                +;:; ;';' +:;;:;+++'.``...  ,  ,  '',;',':`                                                                                ",
"                                                                               `';:; ;';; ,;;;;;+++:.,```.`:       `;` '';;                                                                                ",
"                                                                                :;::.'';;;;;;;:,`.  `,;.            `   '',;                                                                               ",
"                                                                                :;::.;;;: :;;;;;;;';',`    `.            ''`:                                                                              ",
"                                                                                .:;::,';;:,:'+:;:;;;;:`   ``..    '':                                                                                      ",
"                                                                             `:;';'::;;,;:::;;;''+'++;';` ``.,,  +'   '',                                                                                 ", 
"                                                                          `;;;;';``.;;;::::;,:'':;'':';..`.,:,::'''` '';+                                                                                  ",
"                                                                       `;;;;,;;;';;;:'':;#;':::+'';:++,,...,,,::,''`,+'`          ''                                                                       ",
"                                                                     .;;;;;;:::::`.';';;:;;';,:::::;`;+; .,,,,,,.''`++', ''.,`       ``.                                                                   ",
"                                                                   ;;:;:,.,,`     ;;;;;;:;'''::`  ,,,:,   ....`..++ ++'.;++.      '',,,,;                                                                  ",
"                                                                 :::+`           `;;;.;;;:`:;',,   : ,,.``....``,+' +++ +++`      '',,,:;                                                                  ",
"                                                               ,::+.              ;;:  :':   :;.   `:.,,......`..,:+++`:+++;    ''.;..,;.                                                                  ",
"                                                              :,;.                .;`   .:    ..   ::;,;:....,.`.,,.,+.++++.   ''.,,..,,,                                                                  ",
"                                                            `::,                         `         `,`.:`.,,:````.,.,,:'++:   '':,,:.,,.:::                                                                ",
"                                                           ::;                                    ,,   `:.,.`.```.,+;;'`''    ''.,,:,,,,,:;                                                                ",
"                                                          ::;                                     `      .,` '',...,.+;;;:;+++..':::,,,,,:.                                                                ",
"                                                        `:;.                                         `,  ''`,,`,,,,,:'';;+'+#++`'#,,,,,,,:                                                                ", 
"                                                       ,:;                                           `..  `:.::,,  ''++;;++,+#+';,,,,,,,                                                                   ",
"                                                      ::,                                            `,,.   `  .,   ''+;:++;+++:;.,,,,,                                                                    ",
"                                                    .:;`                                            `..,. ; ;       ,',`'' '++ '';,,,,`                                                                    ",
"                                                   .,;                                              `,.,  '`         ;. +:  `: '';;    `                                                                   ",
"                                                  :::                                               ``' `.::            '`   '':;;;,,::`                                                                   ",
"                                                 :;.                                                   .`..`:     `     '   '',,:;;.,  .                                                                   ",
"                                               `,;`                                                   .`.... ..  ``         , '',,,:,   ,` `                                                              ", 
"                                             .,;`                                                  `.,,,```   `,,.::,     '':::;.`':  ';,,,.                                                              ",
"                                            ,:;                                                    `.,, `.     `,,.,:`   '',,,:.,,;;''';:,::                                                              ",
"                                           ,;;                                                    `.,` `..`   ':,,,,,:  ''::,,:,,,': '';:,,.                                                              ",
"                                         `::'                                                     `,`` `.```  ;,,.::::  '':;,,,.,;' :'::::,:                                                             ", 
"                                         ;,,;                                                       ````.. `  +,,,`,;:`.;;:,.,, '''  .;:,:,:                                                             ", 
"                                        ;`;;                                                        `..``.`  ``:::``  ''`.;::..,,:;. ;:::,::                                                             ", 
"                                       `:;:                                                         ```   `  ,.`,,,, ....,...., '';`.:,;::                                                               ", 
"                                       `;`                                                         ````    `.,,,.,.. ''``,.,:..,,:'  :,:                                                                 ", 
"                                       .`                                                           ```   :;.,,,,..`   ,.,:,  ` '':, :,:                                                                 ", 
"                                                                                                     ..,,,`,..,,..``   :.,:`  . '', ..,..                                                                ", 
"                                                                                                      ```:`, ,,,,..    `,.` ` : '',: :.,:                                                                ", 
"                                                                                                          .: .:,,`.     ..  ':; '',';.';:,,,                                                             ", 
"                                                                                                   ,    , :`,,,,,`     ,''``..,:,;'',:;:,::`                                                            ", 
"                                                                                                 :;:,   ::,...`      '',.,...:;:'::::::;;:                                                            ", 
"                                                                                                 ,'`    :,`..```,.   ''`,,.`.,;;;;':::::';                                                            ", 
"                                                                                                .`,    ,: .....`::    '',,.`.,;::::,::;;                                                              ", 
"                                                                                             ```, ,    ,:`,.:..,::    `., ''.,':::::::.                                                               ", 
"                                                                                            ..``  .`   :..,,,,,,.     ` ''.``:':::::::                                                                ", 
"                                                                                                  ., `,,,`,,,,,,.       '',`,;;,:`:`,.                                                                ", 
"                                                                                                 `,.:,`::,,,,,,,,`     ''`.,,.:,: .;;:                                                                ", 
"                                                                                                 ` .,` ;`,::,::,,      ''..,,,:,: .;',                                                                ", 
"                                                                                            .,.,;......;   `::,,`     ''`...,,,: `;':,,,                                                              ", 
"                                                                                            ,.,::.:,..,;` `  .        ''..,.,,,,,::::,,,                                                               ",
"                                                                                           `,:.. .,,.,,;+;,           '',;..,,,,,:: ::::                                                              ", 
"                                                                                           `,`,  `,:.,,:;,;:        ''``,;,..,,,.:` ::.,                                                              ", 
"                                                                                             ,.   .,,., ;,;,`       ''..,::.`;:  ,   :                                                                ", 
"                                                                                             ,,     ..' ..;,.      ''`..,,:,`::  .                                                                    ", 
"                                                                                             ,.     :.,`.,,,`.    ''`.,.,,.,':,                                                                       ", 
"                                                                                             ` .   :  ,.`.,..,    `.`,`,,, ''.,;` `                                                                   ", 
"                                                                                             ` .,;:. .:. .,..,       '':,,,,`.;:'':                                                                   ", 
"                                                                                            `` .;;::. : .....`        ''::;,,,,;+'::.                                                                 ", 
"                                                                                           `,.`::;', `: ` .,`         '',,:..:.,'::,,                                                                 ", 
"                                                                                             `.,,,:: .:;  ..:.         ''`,....:::,.:                                                                 ", 
"                                                                                             `.` ``,,,:'; ,,:;.         '':,:.:;::,,:                                                                 ", 
"                                                                                                  `,:;;;`,::;''      `   ''`;.:'.,,,,                                                                 ", 
"                                                                                                   ,:::;:::::,;  .:```  ` '';,,:,,,;                                                                  ", 
"                                                                                                 ` ..:,,.::::::`,;;,::. ''+,,,:,:,:                                                                   ", 
"                                                                                               `:``,,::,.,;:;:`.,:::. .'' '',,:,;,,                                                                   ", 
"                                                                                                .,,,,.`,::,;;.`.,,.. ''`:,';,,:,.,,                                                                   ", 
"                                                                                                `:.````.,   `.```.,  ''...::,,:,,,:,                                                                  ", 
"                                                                                                .:.,...`    ,,..`.  ''...,,::.:,,::;                                                                  ", 
"                                                                                               `,;,:,,,,   `. ,`    '',,.,,.:`;::;:'                                                                  ", 
"                                                                                               :::,,:.`..;'', .     `` ''``,':;''':.                                                                  ", 
"                                                                                             ` .,',`.,      . `.     ...,,;:  '';':,.                                                                 ", 
"                                                                                              `,`   `:      ` ``      ''.,,.::   ,:,`                                                                 ", 
"                                                                                              .,.;. :,        ``      '',,,,:,.:  ;,                                                                  ", 
"                                                                                             ` ,'':.::        ``      '',,,;::;'; ::`                                                                 ", 
"                                                                                              ;'; ,::        `.      '',,.,,:'',  ,                                                                  ", 
"                                                                                             ``;;.,,:, `             ''`,,.::';:;                                                                    ", 
"                                                                                            .`,.,.,..;;: .         ` '':,,::;;''::,                                                                  ", 
"                                                                                             ,,,`,:.,,:;;.         `,'  ''.;;':;`,,.                                                                 ", 
"                                                                                             :,.,::.,,,;,`        .``,: '',;;;:,.,,,                                                                 ", 
"                                                                                            ..,:  ,: .:::.,      ''`,...;',::;',,,,.                                                                 ", 
"                                                                                            :,;:,`,; ,,:,;:       ,,,.;+': '';:: :,                                                                  ", 
"                                                                                            ::,::,.'`.,,,:;       ''`,..:'''`,:;:                                                                    ", 
"                                                                                          `.,,::: :`..,:,..         '',,;'':::''`                                                                    ", 
"                                                                                          .,.`,.. :., ::,.      .``` '';;';::'+:                                                                     ", 
"                                                                                         ..,..`.,,:,,          .,` '',:`,,,:,;+                                                                      ", 
"                                                                                         `.,,`,,.`;: ; `      `.,``.  '',,,:,,                                                                       ", 
"                                                                                          .`,`:..`:,`''`    `.`.,.,. `,,:,,. ''.                                                                     ", 
"                                                                                          ,`,..,,```:''`     ..``.`'. ''.,,..:;```                                                                   ", 
"                                                                                         `.`.``.`,` :,:,`    `````:. ` ''.,,,;;`...                                                                  ", 
"                                                                                          ,,:.``.;; .::,,   ''````.,::;'.`:.,,::,,,                                                                  ", 
"                                                                                          ,::::;,:+.:,,,,   ....,,:;:, '',:,,,,,::,                                                                  ", 
"                                                                                          ,::,..;`.::;,,    ''`...,,,.:::`,,,,,,..,`                                                                 ", 
"                                                                                          ``.`.,.`:;,'.       ''...,`,..,.`,,,,,....                                                                 ", 
"                                                                                           . ,....:;;;;         ''```.`.;:,,,,,.,,,:                                                                 ", 
"                                                                                           :.,..`.::;;:         ''.`;,,:,`;,,,,,,,,:.                                                                ", 
"                                                                                           `,,.`. ;..::        ```:;``.,:';. '',,:,:,                                                                ", 
"                                                                                          ..``.,,',..;:       ```.. .'::;;:. '',,,,,,                                                                ", 
"                                                                                          ...`` ';.;:;;.     `.., '',`::::,:::,,,,,,                                                                 ", 
"                                                                                          ,....;:':';;',         ''.,`,:;;,:;;,,,,,`                                                                 ", 
"                                                                                           ,,.,:.::;:,,,`        ,, '':,:;::::::,                                                                    ", 
"                                                                                           ,;:,,`,:,,,:,,        ,, '':,,;,,:';,,.                                                                   ", 
"                                                                                            .:;;,.+ `::,.        ,   ''`:;,::'::,`                                                                   ", 
"                                                                                            ;;,..;+.`:,:         :` `, '':,;:;:::                                                                    ", 
"                                                                                             :;,:;';,::         .:,,   ''::;::::                                                                     ", 
"                                                                                             ;, :;;:,,:.      ```;:.  ''`;:::,.  .                                                                   ", 
"                                                                                            :;` ';;,,.,:     ``...,. ,,', '',;;. ,,                                                                  ", 
"                                                                                           ,:; ,';:::.,,     `  '',,.```:;::,;;,,,,`                                                                 ", 
"                                                                                            ` ,, ',,:.,         .,,   '':,,,,,:,,,,                                                                  ", 
"                                                                                              ;: ;;..`         `.,,   '':..,,,,,.,                                                                   ", 
"                                                                                            `;::,,:            `,,. ''`.::,:,:,:,                                                                    ", 
"                                                                                           `,:;;;,:             ` ''`.,,;.:;::,,.                                                                    ", 
"                                                                                           ` . ::..              '',,.,,:.,,,:, .                                                                    ", 
"                                                                                              :::.              '',`,.,:,,,,,                                                                        ", 
"                                                                                             ,:,`'               '',,,:....,:,                                                                       ",
"                                                                                            `` ,,                ''.,:......:,                                                                       ", 
"                                                                                              :,:               ''`,,,,.`...,,`                                                                       ",
"                                                                                             .,;`              ''`,,:,,,...,,,.                                                                      ", 
"                                                                                              ,.`             ''`.`..:;;,....,                                                                       ", 
"                                                                                              ,,`            ''```..`.;:;,`.``                                                                       ", 
"                                                                                               `            .. `.., '';;,:.``                                                                        ", 
"                                                                                                             . ''`.,.,',,,,,:                                                                        ", 
"                                                                                                             '',``,..,;::::,.                                                                        ", 
"                                                                                                              '',``...;::',..                                                                        ", 
"                                                                                                               ''``.:,:;.;;,:                                                                        ", 
"                                                                                                               '',`,::.:`:;::`                                                                       ", 
"                                                                                                             ``::,., ''``;:':                                                                        ", 
"                                                                                                            ``::,    ''..;:::                                                                        ", 
"                                                                                                            `.,:     ''.,`;:                                                                         ", 
"                                                                                                            ..,.   ''`....                                                                           ", 
"                                                                                                            ,`:::,` ''````'`,                                                                        ", 
"                                                                                                           :...:`   ` ''.,,;:                                                                        ", 
"                                                                                                           :..,,    ,  ''`,:.,                                                                       ", 
"                                                                                                           ;,,,,    .  '',`,,,,                                                                      ", 
"                                                                                                           ;;,,.  .;. ''.,`,.::                                                                      ", 
"                                                                                                           .,`.:;::`, '',...::.                                                                      ", 
"                                                                                                           ,.,.;'' ,,,   ''.,:                                                                       ", 
"                                                                                                           `,..,''..  .  '';                                                                         ", 
"                                                                                                           ``..::...` '','.:                                                                         ", 
"                                                                                                           ''``..::,:.,`,,:.                                                                         ", 
"                                                                                                           ,`.,::,,,,,., ''.                                                                         ", 
"                                                                                                          ''::,``.::.,`.::`,`                                                                        ", 
"                                                                                                          :::,`   ;:` ` ''`::;                                                                       ", 
"                                                                                                          :,,. . ' :., ''`,.:,                                                                       ", 
"                                                                                                          `,,. :', ;.   ''...,                                                                       ", 
"                                                                                                           ,.  ,;;;: :   ''..,                                                                       ", 
"                                                                                                             ,.,,: :  ,` '',,                                                                        ", 
"                                                                                                             ;:,::.:. '',:`:                                                                         ", 
"                                                                                                             '',:;.:.;``'``.,.                                                                       ", 
"                                                                                                            ''..;;.:.;,:.`.:,,                                                                       ", 
"                                                                                                            .,``  '',;`,,..::`                                                                       ", 
"                                                                                                            ,,`  . ; ''.:::::                                                                        ", 
"                                                                                                            ,,` ''.`.:`'::,..                                                                        ", 
"                                                                                                             .  . '':::,.;;.                                                                         ", 
"                                                                                                                 '':,:;`.```                                                                         ", 
"                                                                                                                `, '':,:..`                                                                          ", 
"                                                                                                             ` :: ''`.,,:,                                                                           ", 
"                                                                                                             ''```:..,,.,`                                                                           ", 
"                                                                                                            ``` ''.,::.,,,                                                                           ", 
"                                                                                                            `..`..: '',:::                                                                           ", 
"                                                                                                            ''`.,,,,.`.;::.                                                                          ", 
"                                                                                                             ''`.:,:,:.:;;:                                                                          ", 
"                                                                                                              ''+:,:.,.;;'`                                                                          ", 
"                                                                                                             ''`,:;,.,,+':                                                                           ", 
"                                                                                                           ''`,,`,:::';;.                                                                            ", 
"                                                                                                           ''::..,,;.:;``                                                                            ", 
"                                                                                                           ::::,::.;. '',                                                                            ", 
"                                                                                                            ,,:,,;,' ''.`                                                                            ", 
"                                                                                                             '',:,;.:,`::                                                                            ", 
"                                                                                                             ''```',:':::                                                                            ", 
"                                                                                                             ''``..'.:;::,,                                                                          ", 
"                                                                                                             ''``,.,.:,:,,;                                                                          ", 
"                                                                                                             ''`.,,,,`:;;;,                                                                          ", 
"                                                                                                              '',,,,,`:':.                                                                           ", 
"                                                                                                              ''.,.```::`                                                                            ", 
"                                                                                                               '',.``.,.                                                                             ", 
"                                                                                                                '',:,,,::                                                                            ", 
"                                                                                                                '':,`,:.                                                                             ", 
"                                                                                                                ''.`,,,                                                                              ", 
"                                                                                                                '':,,.                                                                               ", 
"                                                                                                               '',;`.'`                                                                              ", 
"                                                                                                               , ''`;`,                                                                              ", 
"                                                                                                                 ''.:.                                                                               ", 
"                                                                                                                '',:.:                                                                               ", 
"                                                                                                               `,,: ''`                                                                              ", 
"                                                                                                                ''.,,                                                                                ", 
"                                                                                                               ''`,,                                                                                ", 
"                                                                                                                ''`,:                                                                                ", 
"                                                                                                                 '',                                                                                 ", 
"                                                                                                                             ''                                                                      ", 
"                                                                                                                             ''                                                                      ", 
"                                                                                                                                                                                                       "]

# So the ascii appears on the webpage from bottom to top
texts.reverse()

# How many arduinos do we expect to hear from?
# Arduino TX/RX01, Arduino TX/RX02, Arduino TX/RX03, Arduino TX/RX04, Arduino TX/RX05, Arduino TX/RX06
receivers = [0xF0F0F0F0C3]
transmitters = [0xF0F0F0F0B2]
t_indexes = ["0xF0F0F0F0B2"]
num_children = len(transmitters)

# Start the radio
radio.begin()

radio.setRetries(3, 5);
radio.enableDynamicPayloads();
radio.printDetails()

##########################################
# STATUS
#
# sending = 0 (when we select an image, transform to byte array and transmit to receiving children)
# receiving = 1 (while we wait to hear back from transmitting children)
# saving = 2 (we heard back from all transmitting children, now save to DB)
# Then go back to 'init'!

status = 0

# Get the time
millis = lambda: int(round(time.time() * 1000))

# Dict for saving received data from transmitting children arduinos
received_payloads = dict()
payload_index = 0
payload_size = 4

# Endpoint for display
url = 'https://weise7.org/plant-2-plant/save'
# url = 'http://192.168.2.1:3000/save'

##########################################
# DEFs
#
def select_text(index=0):
    return texts[index]

def save_images():
    for child in received_payloads:
        files = { 'file': ('image.bmp', io.BytesIO(received_payloads[child]), 'image/bmp') }
        r = requests.post(url, files=files)

def check_responses():
    # first check if the dictionary has entries for all transmitting children
    # print('length of received_payloads dict {} should == num_children {}'.format(len(received_payloads), num_children))
    if len(received_payloads) < num_children:
        return False

    # then check if each child has the correct number of entries to its list
    for child in received_payloads:
        # print('len(received_payloads[child])/4 {} should == transmission_id {}'.format(len(received_payloads[child])/4, transmission_id))
        # divide by four because we are adding batches of 4 packets per tranmission
        if len(received_payloads[child])/4 < transmission_id:
            return False

    print("responses are good!")
    return True

def handle_timeouts():
    # fill the spot in the file with whatever other chars so we can move on
    if len(received_payloads) < num_children:
        # print('missing a key!')

        tx_keys = received_payloads.keys()
        for t in t_indexes:
            if not t in tx_keys:
                # print('will create key {}'.format(t))
                received_payloads[t] = bytearray(b'__')
                # print(received_payloads)

    # then check if each child has the correct number of entries to its list
    for t in received_payloads:
        # divide by four because we are adding batches of 4 packets per tranmission
        if len(received_payloads[t])/4 < transmission_id:
            #print('{} was missing a packet!'.format(t))
            received_payloads[t].extend(b'__')
            #print(received_payloads[t])

def read_file_data(channel=0):
    if radio.available():
        while radio.available():
            p = radio.available_pipe()
            if (p[0] and p[1]):
                #print('# # # # # # # # # # # # # #\n')
                #print('p {}\n'.format(p))

                len = radio.getDynamicPayloadSize()
                file_payload = radio.read(len)

                key = t_indexes[p[1]-1]
                #print('key {}'.format(key))
                if key in received_payloads:
                    received_payloads[key].extend(file_payload)
                else:
                    received_payloads[key] = bytearray(file_payload)

                # print('Received payload {} on pipe {}\n'.format(file_payload, key));
                print('All saved payloads {}\n'.format(received_payloads));

##########################################
# INIT
#

send_payload = select_text(text_id)
max_payload_size = len(send_payload)
#print(send_payload)
#print('max_payload_size {}, will require {} transmissions'.format(max_payload_size, max_payload_size/payload_size))

# forever loop
while 1:

    # sending data
    if status == 0:
        # First, stop listening so we can talk.
        radio.stopListening()

        # Send next chunk
        payload = send_payload[payload_index:payload_index+payload_size]

        print('Status 0: Sending {}'.format(payload))

        for n in range(0, num_children):
            # open the writing pipe with the address of a receiver child
            radio.openWritingPipe(receivers[n])
            result = radio.write(payload.encode('utf-8'))

            print('successful send to receiver child {}? {}'.format(receivers[n], result))

            if result:
                txNum += 1
                if (txNum >= num_children):
                    #print('Sent successfully to all receiving children.')
                    txNum = 0
                    status = 1
            else:
                print('TX failed')

    # receiving data
    elif status == 1:
        #print('Status 1: Waiting for data from transmitting children Arduinos\n')

        # Now we wait to get the data back from the sender Arduino
        radio.startListening()

        # Wait here until we have heard from everyone, or timeout
        started_waiting_at = millis()
        timeout = False

        while (not check_responses()) and (not timeout):
            for n in range(0, num_children):
                # open the reading pipe with the address of a transmitting child
                radio.openReadingPipe(n+1, transmitters[n])
                # Read the file data and save it to our dict once it shows up
                read_file_data()

                if (millis() - started_waiting_at) > 200:
                    timeout = True

        # Describe the results
        if timeout:
            # print('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n')
            # print('Fail - Response timed out. Handling and then moving on.')

            handle_timeouts()
            timeout = False

            # print('<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n')
        else:
            #print('Success - Moving onto transmission {}'.format(transmission_id))
            # Start a new round of transmission
            transmission_id += 1

            # Step through the payload...
            payload_index += payload_size

            # If we have stepped through the entire payload, save to database
            if payload_index >= max_payload_size:
                status = 2
            else:
                # otherwise, set status back to 0 so we transmit again
                status = 0

    # saving data
    elif status == 2:
        # print('Status 2: Received all image data back, saving image locally and to DB\n')

        # Now we save it to our web app endpoint
        save_images()

        # reset everything:
	if text_id == len(texts)-1:
	    text_id = 0
	else:
	    text_id += 1
        send_payload = select_text(text_id)
        max_payload_size = len(send_payload)
        #print('New max_payload_size {}'.format(max_payload_size))
        received_payloads = dict()
        payload_index = 0
        transmission_id = 1
        txNum = 0
        status = 0

    # debugging
    elif status == 3:
        continue
        # test status, print nothing, go back to beginning of loop

    # error; status equals something strange
    else:
        print('Status error! {}\n'.format(status))

    time.sleep(0.1)
